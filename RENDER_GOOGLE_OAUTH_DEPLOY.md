# Render Production Deployment with Google OAuth

## üöÄ Deployment Steps

### 1. Push to GitHub

Your code is ready to push with Google OAuth integrated:

```bash
cd /home/coder1/pythonbot/journal-app
git add .
git commit -m "Add Google OAuth authentication and enhanced admin panel"
git push origin main
```

### 2. Connect to Render

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New"** ‚Üí **"Web Service"**
3. Connect your GitHub repository: `devashishhswami-ux/journal`
4. Render will auto-detect `render.yaml` configuration

### 3. Configure Google Cloud Console (CRITICAL!)

After your app deploys, you'll get a URL like: `https://journal-pro.onrender.com`

**You MUST add this redirect URI in Google Cloud Console:**

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to **APIs & Services** ‚Üí **Credentials**
3. Click your OAuth 2.0 Client ID
4. Under **Authorized redirect URIs**, add:
   ```
   https://your-app-name.onrender.com/accounts/google/login/callback/
   ```
   *(Replace `your-app-name` with your actual Render domain)*

5. Click **Save**

### 4. Configure Django Site Domain

After first deployment, you need to set the correct site domain:

**Option A: Via Django Admin (Recommended)**
1. Go to `https://your-app.onrender.com/admin/`
2. Login with admin credentials (check Render logs for auto-generated password)
3. Navigate to **Sites** ‚Üí **example.com**
4. Change:
   - **Domain name**: `your-app-name.onrender.com` (NO http:// or https://)
   - **Display name**: `Journal Pro`
5. Click **Save**

**Option B: Via Render Shell**
```bash
# In Render dashboard, open Shell and run:
python manage.py shell

# Then execute:
from django.contrib.sites.models import Site
site = Site.objects.get_current()
site.domain = 'your-app-name.onrender.com'
site.name = 'Journal Pro'
site.save()
exit()
```

---

## üìã Environment Variables Configuration

### Required Variables (Auto-configured in render.yaml):
- ‚úÖ `SECRET_KEY` - Auto-generated by Render
- ‚úÖ `DEBUG=False` - Production mode
- ‚úÖ `DATABASE_URL` - PostgreSQL connection string
- ‚úÖ `ADMIN_USERNAME=admin`
- ‚úÖ `ADMIN_EMAIL=admin@journalpro.com`
- ‚úÖ `ADMIN_PASSWORD` - Auto-generated by Render

### Required Variables (MUST ADD MANUALLY):

After deployment, go to your Render Dashboard ‚Üí **Environment** tab and add:

```
GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
```

**Get these from:**
1. [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to **APIs & Services** ‚Üí **Credentials**
3. Copy your OAuth 2.0 Client ID and Client Secret

### Optional (Email for Password Reset):
If you want email password reset functionality in production:

1. Get a Gmail App Password:
   - Go to https://myaccount.google.com/apppasswords
   - Generate password for "Journal App"

2. Add in Render Dashboard (Environment tab):
   ```
   EMAIL_HOST_USER=your-email@gmail.com
   EMAIL_HOST_PASSWORD=your-16-char-app-password
   DEFAULT_FROM_EMAIL=Journal Pro <your-email@gmail.com>
   ```

---

## üîç Verify Deployment

### Check Logs
In Render Dashboard ‚Üí **Logs**, you should see:
```
Migrations complete
Admin user created/verified
Starting Gunicorn server
```

### Test Google Sign-In
1. Visit: `https://your-app.onrender.com/accounts/login/`
2. Click "Sign in with Google"
3. Complete OAuth flow
4. Should redirect to journal homepage

### Check Admin Panel
1. Visit: `https://your-app.onrender.com/admin/`
2. Login with admin credentials (check logs for password)
3. Navigate to **Social Accounts** to see Google data

---

## üéØ What's Deployed

### Frontend:
- Login page with Google Sign-In button
- Signup page with Google Sign-Up button
- Responsive mobile design

### Backend:
- Google OAuth authentication
- PostgreSQL database (Neon/Render)
- Static files served via WhiteNoise
- Automatic migrations on deploy

### Admin Panel:
- Enhanced User admin showing login methods
- Social Accounts section with:
  - Profile pictures
  - Email verification status
  - Full name, locale, country
  - Complete JSON data from Google

---

## üêõ Troubleshooting

### Issue: "Redirect URI mismatch"
**Solution:** Make sure you added the EXACT redirect URI in Google Cloud Console:
```
https://your-app.onrender.com/accounts/google/login/callback/
```

### Issue: "Site matching query does not exist"
**Solution:** Configure the Django Site domain (see Step 4 above)

### Issue: Google Sign-In redirects to wrong domain
**Solution:** Update the Site domain in Django admin to match your Render URL (NO http:// or https://)

### Issue: Can't find admin password
**Solution:** Check Render logs during first deployment or set a new one:
```bash
# In Render Shell:
python manage.py changepassword admin
```

---

## üìä Post-Deployment Checklist

After deployment, verify:

- [ ] App is accessible at `https://your-app.onrender.com`
- [ ] **Google Cloud Console** redirect URI added
- [ ] **Django Site** domain configured correctly
- [ ] Google Sign-In button appears on login page
- [ ] Can sign in with Google successfully
- [ ] Admin panel accessible
- [ ] Social Accounts section shows Google profiles
- [ ] Profile pictures display correctly

---

## üîÑ Future Updates

To deploy updates:

```bash
# Make changes to code
git add .
git commit -m "Your update message"
git push origin main

# Render will auto-deploy (autoDeploy: true in render.yaml)
```

---

## üîë Security Notes

‚úÖ **Credentials in render.yaml:**
- Google Client ID/Secret are OK to commit (they're tied to specific domains)
- Render auto-generates SECRET_KEY and ADMIN_PASSWORD securely
- `.env` file is gitignored (local development only)

‚úÖ **Production Security:**
- DEBUG=False (hides error details)
- HTTPS enforced by Render
- CSRF protection enabled
- Session cookies secure
- WhiteNoise for static files

---

## üìû Support Resources

- **Render Docs**: https://render.com/docs/deploy-django
- **Django Allauth**: https://django-allauth.readthedocs.io/
- **Google OAuth**: https://console.cloud.google.com/

Your app is production-ready! üöÄ
